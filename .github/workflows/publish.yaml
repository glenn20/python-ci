name: Publish python package

on:
  workflow_call:
    inputs:
      package-name:
        description: 'Name of the package to publish'
        required: true
        type: string
      pypi:
        description: 'Set to "pypi" or "test.pypi" (default).'
        default: 'test.pypi'
        required: false
        type: string

jobs:
  publish:
    name: Publish package to PyPI
    runs-on: ubuntu-latest

    environment:
      name: publish-${{ inputs.pypi }}
      url: https://${{ inputs.pypi }}.org/p/${{ inputs.package-name }}
    permissions:
      id-token: write  # IMPORTANT: mandatory for trusted publishing

    steps:
      - name: Download all the dists
        uses: actions/download-artifact@v4
        with:
          name: python-package
          path: dist/

      - name: Install uv
        uses: astral-sh/setup-uv@v3

      - name: Publish python package
        run: uv publish -vvvv
        env:
          UV_PUBLISH_URL: https://${{ inputs.pypi }}.org/legacy/
